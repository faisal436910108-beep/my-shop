<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù…Ù†ØµØ© Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø­Ø§Ø³Ø¨ÙŠØ© | Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
<style>
  :root{ --bg:#f9fafb; --card:#fff; --muted:#6b7280; --text:#1f2937; --brand:#3b82f6; --border:rgba(0,0,0,.12);}
  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial,sans-serif}
  .container{max-width:1100px; margin:16px auto; padding:0 16px}
  .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px}
  .btn{background:var(--brand); color:#fff; border:none; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:700}
  .hidden{display:none!important}
  .square{max-width:560px; margin:auto; background:#fff; border:1px solid var(--border); border-radius:16px; padding:18px; display:grid; gap:14px}
  .qbox{background:#f3f4f6; border:1px solid var(--border); border-radius:12px; padding:14px; font-size:18px}
  .choice{border:1px solid var(--border); border-radius:12px; padding:12px; cursor:pointer; text-align:start}
  .choice.selected{background:#dbeafe; border-color:var(--brand)}
  .final{text-align:center; font-weight:800; padding:10px; border-radius:12px; background:#f9fafb}
  .review{margin-top:14px; padding:12px; border-radius:12px; background:#f9fafb; border:1px solid var(--border)}
  .pass{color:#16a34a} .fail{color:#dc2626}
  .timer{position:fixed; top:14px; inset-inline-end:14px; background:#fff; border:1px solid var(--border); border-radius:12px; padding:8px 12px; font-weight:800; min-width:140px; text-align:center}
</style>
</head>
<body>
<div class="container">

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <section id="page-login" class="page">
    <div class="card">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <input id="emailInput" type="email" placeholder="name@example.com" style="width:100%;padding:12px;margin-bottom:10px;border:1px solid var(--border);border-radius:10px">
      <button id="loginBtn" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <p id="loginError" class="fail hidden">ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­</p>
    </div>
  </section>

  <!-- Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
  <section id="page-start" class="page hidden">
    <div class="card">
      <h2>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
      <button id="goToQuiz" class="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
    </div>
  </section>

  <!-- Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
  <section id="page-quiz" class="page hidden">
    <div id="timer" class="timer hidden">01:20:00</div>
    <div class="square">
      <div class="qbox" id="qText">â€”</div>
      <div class="choices" id="choices"></div>
      <div class="final hidden" id="finalBox"></div>
      <div class="review hidden" id="reviewBox"></div>
      <button class="btn" id="nextBtn" disabled>Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
  </section>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* Ø¥Ø¹Ø¯Ø§Ø¯ Supabase */
const SUPABASE_URL  = "https://ryafsydlamazuofjdxvm.supabase.co"; // Ø¶Ø¹ Ø±Ø§Ø¨Ø·Ùƒ
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."; // Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ
const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

/* Ø¹Ù†Ø§ØµØ± */
const pageLogin=document.getElementById('page-login');
const pageStart=document.getElementById('page-start');
const pageQuiz=document.getElementById('page-quiz');
const emailInput=document.getElementById('emailInput');
const loginBtn=document.getElementById('loginBtn');
const loginError=document.getElementById('loginError');
const goToQuiz=document.getElementById('goToQuiz');
const qText=document.getElementById('qText');
const choicesBox=document.getElementById('choices');
const nextBtn=document.getElementById('nextBtn');
const finalBox=document.getElementById('finalBox');
const reviewBox=document.getElementById('reviewBox');
const timerEl=document.getElementById('timer');

/* Ø£Ø³Ø¦Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© */
const QUESTIONS=[{text:"[Ù†Ø¸Ø±ÙŠ] Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù„ Ø£Ø¯Ù‚ Ø¹Ù† Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø«Ø§Ø¨ØªØŸ",choices:["ÙŠØ³ØªÙ‡Ù„Ùƒ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„","Ù‚Ø³Ø· Ø³Ù†ÙˆÙŠ = (Ø§Ù„ØªÙƒÙ„ÙØ© - Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ) Ã· Ø§Ù„Ø¹Ù…Ø±","Ù„Ø§ ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„ØªØºÙŠÙŠØ±","Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Ù„Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©"],correctIndex:1}];

let idx=0, userAnswers=[], score=0, userEmail=null;
let remaining=0, intervalId=null;

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
loginBtn.addEventListener('click',()=>{
  const email=(emailInput.value||'').trim();
  const ok=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  if(!ok){loginError.classList.remove('hidden');return;}
  loginError.classList.add('hidden');
  userEmail=email;
  localStorage.setItem('userEmail',email);
  pageLogin.classList.add('hidden');
  pageStart.classList.remove('hidden');
});

/* Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
goToQuiz.addEventListener('click',()=>{
  pageStart.classList.add('hidden');
  pageQuiz.classList.remove('hidden');
  idx=0;score=0;userAnswers=[];
  startTimer();
  loadQuestion();
});

/* Ø§Ù„Ù…Ø¤Ù‚Øª */
function fmt(s){const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),ss=s%60;const pad=n=>String(n).padStart(2,'0');return `${pad(h)}:${pad(m)}:${pad(ss)}`;}
function updateTimerUI(){timerEl.textContent=fmt(remaining);}
function tick(){remaining--; if(remaining<=0){remaining=0; stopTimer(); endQuiz("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª â°");} updateTimerUI();}
function startTimer(){remaining=80*60; updateTimerUI(); timerEl.classList.remove('hidden'); stopTimer(); intervalId=setInterval(tick,1000);}
function stopTimer(){if(intervalId){clearInterval(intervalId);intervalId=null;}}

/* ØªØ­Ù…ÙŠÙ„ Ø³Ø¤Ø§Ù„ */
function loadQuestion(){
  const q=QUESTIONS[idx];
  qText.textContent=q.text;
  choicesBox.innerHTML='';
  q.choices.forEach((c,i)=>{
    const btn=document.createElement('button');
    btn.className='choice';
    btn.textContent=c;
    if(userAnswers[idx]===i) btn.classList.add('selected');
    btn.onclick=()=>{document.querySelectorAll('.choice').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');userAnswers[idx]=i;nextBtn.disabled=false;};
    choicesBox.appendChild(btn);
  });
  nextBtn.disabled=(userAnswers[idx]==null);
}

/* Ø§Ù„ØªØ§Ù„ÙŠ */
nextBtn.addEventListener('click',()=>{
  if(userAnswers[idx]==null)return;
  idx++;
  if(idx<QUESTIONS.length){loadQuestion();}
  else endQuiz("Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ğŸ‰");
});

/* Ø¥Ù†Ù‡Ø§Ø¡ */
async function endQuiz(message){
  stopTimer();
  score=userAnswers.reduce((a,ans,i)=>a+(ans===QUESTIONS[i].correctIndex?1:0),0);
  const total=QUESTIONS.length;
  const pct=Math.round((score/total)*100);
  const passed=pct>=60;
  finalBox.classList.remove('hidden');
  finalBox.innerHTML=`<div>${message||''}</div><div>Ù†ØªÙŠØ¬ØªÙƒ: <strong>${score}</strong> Ù…Ù† <strong>${total}</strong> (${pct}%)</div><div class="${passed?'pass':'fail'}">${passed?'Ù†Ø§Ø¬Ø­ ğŸ‰':'Ø±Ø§Ø³Ø¨ ğŸ˜¢'}</div>`;
  reviewBox.classList.remove('hidden');
  reviewBox.innerHTML=QUESTIONS.map((q,i)=>`<div><b>Ø³${i+1}:</b> ${q.text}<br>Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${q.choices[userAnswers[i]]||'â€”'}<br>Ø§Ù„ØµØ­ÙŠØ­Ø©: ${q.choices[q.correctIndex]}</div>`).join('<hr>');
  
  if(userEmail){
    const { error } = await supa.from('results_open').insert({
      email:userEmail,
      score:score,
      total:total,
      percent:pct,
      details:JSON.stringify(userAnswers)
    });
    if(error) console.error('DB error',error.message);
  }
}
</script>
</body>
</html>
